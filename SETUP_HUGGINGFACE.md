# Инструкция по настройке Hugging Face API

## Шаг 1: Получение Hugging Face API ключа

1. Зарегистрируйтесь на https://huggingface.co/
2. Перейдите в Settings → Access Tokens
3. Создайте новый токен (Token) с правами "Read"
4. Скопируйте токен (он начинается с `hf_...`)

## Шаг 2: Настройка переменных окружения

1. Перейдите в директорию бэкенда:
```bash
cd backend
```

2. Создайте или откройте файл `.env`:
```bash
nano .env
```

3. Добавьте следующие переменные:
```env
# DeepSeek API (если еще не добавлено)
DEEPSEEK_API_KEY=your_deepseek_api_key_here

# Hugging Face API (НОВОЕ - обязательно!)
HUGGINGFACE_API_KEY=hf_your_token_here

# Порт сервера
PORT=3000

# Провайдер по умолчанию (deepseek или huggingface)
DEFAULT_PROVIDER=deepseek

# Модель по умолчанию для DeepSeek
DEEPSEEK_MODEL=deepseek-chat

# Модель по умолчанию для Hugging Face
HUGGINGFACE_MODEL=Qwen/Qwen2.5-7B-Instruct
```

4. Сохраните файл (Ctrl+O, Enter, Ctrl+X в nano)

## Шаг 3: Перезапуск бэкенд сервера

Если сервер уже запущен, его нужно перезапустить:

1. Остановите текущий процесс (Ctrl+C в терминале, где запущен сервер)

2. Запустите сервер заново:
```bash
cd backend
npm start
```

Или если используете PM2:
```bash
pm2 restart deepseek-proxy
```

## Шаг 4: Проверка работы

1. Проверьте, что сервер запущен:
```bash
curl http://localhost:3000/health
```
Должен вернуться: `{"status":"ok"}`

2. Проверьте список моделей:
```bash
curl http://localhost:3000/api/models
```
Должен вернуться JSON со списком моделей для обоих провайдеров

3. Откройте Flutter приложение и проверьте:
   - Нажмите на иконку выбора модели (иконка с шестеренкой/моделью) в AppBar
   - Должен открыться диалог с выбором провайдера и модели
   - Попробуйте переключиться между DeepSeek и Hugging Face

## Возможные ошибки и решения

### Ошибка: "HUGGINGFACE_API_KEY is not set"
**Решение:** Убедитесь, что вы добавили `HUGGINGFACE_API_KEY` в `.env` файл и перезапустили сервер.

### Ошибка: "Failed to get response from AI service"
**Решение:** 
- Проверьте, что токен Hugging Face правильный
- Убедитесь, что токен имеет права "Read"
- Проверьте логи сервера для деталей ошибки

### Ошибка: "Could not find the correct Provider<ChatBloc>"
**Решение:** 
- Выполните hot restart (не hot reload) в Flutter
- Или полностью перезапустите приложение

### Список моделей не загружается
**Решение:**
- Проверьте, что бэкенд доступен на порту 3000
- Проверьте консоль браузера на наличие CORS ошибок
- Убедитесь, что endpoint `/api/models` возвращает данные

## Использование

После настройки вы можете:

1. **Выбрать провайдера** - нажмите на иконку модели в AppBar и выберите DeepSeek или Hugging Face
2. **Выбрать модель** - в том же диалоге выберите конкретную модель:
   - Предустановленные: Топовая, Средняя, Легкая
   - Или выберите из полного списка доступных моделей
3. **Отправить сообщение** - выбранная модель будет использоваться для генерации ответов

## Примечания

- Hugging Face API может иметь лимиты на количество запросов в зависимости от вашего аккаунта
- Некоторые модели могут быть недоступны через Inference API - в этом случае используйте предустановленные модели
- Для production рекомендуется использовать Inference Endpoints вместо Inference API
